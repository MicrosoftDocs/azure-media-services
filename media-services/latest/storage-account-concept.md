---
title: Azure storage accounts
description: Learn how to create an Azure storage account to use with Azure Media Services.
author: IngridAtMicrosoft
ms.service: media-services
ms.topic: conceptual
ms.date: 3/16/2022
ms.author: inhenkel
---

# Azure Storage accounts

[!INCLUDE [media services api v3 logo](./includes/v3-hr.md)]

To start managing, encrypting, encoding, analyzing, and streaming media content in Azure, you need to create a Media Services account. When creating a Media Services account, you need to supply the name of an Azure Storage account resource. The specified storage account is attached to your Media Services account.

## Usage of cross-subscription storage accounts

The Media Services account and associated storage accounts can be in any subscription within the same tenant if you are using managed identity to authenticate. Otherwise, if you are not using managed identity, the storage accounts must reside in the same subscription as the Media Service account. It's recommended to use storage accounts in the same region as the Media Services account to avoid additional data egress costs.

## Required storage account types and limits

You must have one **Primary** storage account and you can have any number of **Secondary** storage accounts associated with your Media Services account. Media Services supports **General-purpose v2** (GPv2) or **General-purpose v1** (GPv1) accounts only. Azure Data Lake Gen2 or blob only accounts aren't allowed to be used as **Primary** or **Secondary**.

We recommend that you use General-purpose v2, so you can take advantage of the latest features and performance. To learn more about storage account types, see [Azure Storage account overview](https://docs.microsoft.com/storage/common/storage-account-overview.md).

Azure Data Lake Gen2 storage is not supported by Media Services. To ingest content from a storage account using hierarchical namespace support, you must submit encoding jobs using SAS URLs and the JobInputHttp feature in Media Services.

> [!NOTE]
> It is recommended to use the hot storage tier when streaming assets for live or VOD. Cool storage can be used for encoding jobs and long term storage of assets that are not actively being streamed, but keep in mind the higher costs of reading from cool storage if you plan to do a lot of reads on content. One strategy can be to move your master/mezzanine source assets into a secondary storage account that is configured as cool storage to reduce the long term costs of retention on your source files, and output your encoded files for streaming into a storage account configured for hot storage.

There are different SKUs you can choose for your storage account. If you want to experiment with storage accounts, use `--sku Standard_LRS`. However, when picking a SKU for production, you should consider `--sku Standard_RAGRS`, which provides geographic replication for business continuity.

## Assets in a storage account

In Media Services v3, the Storage APIs are used to upload files into assets. For more information, see [Assets in Azure Media Services v3](assets-concept.md).

> [!Note]
> Don't attempt to change the contents of blob containers that were generated by the Media Services SDK without using Media Services APIs.

## Storage side encryption

To protect your assets at rest, the assets should be encrypted by the storage side encryption. The following table shows how the storage side encryption works in Media Services v3:

|Encryption option|Description|Media Services v3|
|---|---|---|
|Media Services storage encryption| AES-256 encryption, key managed by Media Services. |Not supported.<sup>1</sup>|
|[Storage service encryption for data at rest](https://docs.microsoft.com/storage/common/storage-service-encryption.md)|Server-side encryption offered by Azure Storage, key managed by Azure or by customer.|Supported.|
|[Storage client-side encryption](https://docs.microsoft.com/storage/common/storage-client-side-encryption.md)|Client-side encryption offered by Azure storage, key managed by customer in Key Vault.|Not supported.|

<sup>1</sup> In Media Services v3, storage encryption (AES-256 encryption) is only supported for backwards compatibility when your assets were created with Media Services v2, which means v3 works with existing storage encrypted assets but won't allow creation of new ones.

## Storage account double encryption

Storage accounts support double encryption but the second layer must explicitly be enabled. See [Azure Storage encryption for data at rest](https://docs.microsoft.com/storage/common/storage-service-encryption.md#doubly-encrypt-data-with-infrastructure-encryption).  

## Storage account errors

The "Disconnected" state for a Media Services account indicates that the account no longer has access to one or more of the attached storage accounts due to a change in storage access keys. Up-to-date storage access keys are required by Media Services to perform many tasks in the account.

The following are the primary scenarios that would result in a Media Services account not having access to attached storage accounts.

|Issue|Solution|
|---|---|
|The Media Services account or attached storage account(s) were migrated to separate subscriptions. |Migrate the storage account(s) or Media Services account so that they're all in the same subscription or use managed identity for storage account authentication if your storage account is in the same tenant. |
|The Media Services account is using an attached storage account in a different subscription as it was an early Media Services account where this was supported. All early Media Services accounts were converted to modern Azure Resources Manager based accounts and will have a Disconnected state. |Migrate the storage account or Media Services account so that they're all in the same subscription or use managed identity for storage account authentication if your storage account is in the same tenant.|
